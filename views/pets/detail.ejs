<%- include('../partials/header', { title: title }) %>
<div class="container">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/pets">My Pets</a></li>
                    <li class="breadcrumb-item active"><%= pet.name %></li>
                </ol>
            </nav>

            <!-- Animation Overlay -->
            <div id="animationOverlay" class="animation-overlay">
                <img id="animationGif" src="" alt="Animation" class="animation-gif">
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0">
                        <!-- Species emoji based on pet species -->
                        <% 
                            const speciesEmoji = {
                                'dragon': 'üêâ',
                                'cat': 'üê±', 
                                'dog': 'üê∂',
                                'rat': 'üêÄ',
                                'elf': 'üßù',
                                'robot': 'ü§ñ',
                                'wolf': 'üê∫',
                                'deer': 'ü¶å',
                                'duck': 'ü¶Ü',
                                'bear': 'üêª'
                            };
                        %>
                        <%= speciesEmoji[pet.species] || 'üêæ' %> <%= pet.name %>
                        <span class="badge bg-<%= 
                            pet.rarity === 'Legendary' ? 'danger' : 
                            pet.rarity === 'Epic' ? 'warning' :
                            pet.rarity === 'Rare' ? 'info' : 'secondary'
                        %> float-end"><%= pet.rarity %></span>
                    </h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Left Column - Pet Info -->
                        <div class="col-md-6">
                            <h5>Basic Information</h5>
                            <p><strong>Species:</strong> <%= pet.species.charAt(0).toUpperCase() + pet.species.slice(1) %></p>
                            <p><strong>Birth Date:</strong> <%= pet.birthDate.toLocaleDateString() %></p>
                            
                            <% if (pet.traits && pet.traits.length > 0) { %>
                                <p><strong>Traits:</strong><br>
                                <% pet.traits.forEach(trait => { %>
                                    <span class="badge bg-primary me-1 mb-1"><%= trait %></span>
                                <% }) %>
                                </p>
                            <% } %>
                            
                            <!-- Status Section -->
                            <h5 class="mt-4">Status</h5>
                            
                            <div class="mb-3">
                                <label>Hunger: <%= pet.stats.hunger %>/100</label>
                                <div class="progress">
                                    <div class="progress-bar bg-<%= pet.stats.hunger > 50 ? 'success' : 'warning' %>" 
                                         style="width: <%= pet.stats.hunger %>%"></div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label>Happiness: <%= pet.stats.happiness %>/100</label>
                                <div class="progress">
                                    <div class="progress-bar bg-<%= pet.stats.happiness > 50 ? 'success' : 'warning' %>" 
                                         style="width: <%= pet.stats.happiness %>%"></div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label>Energy: <%= pet.stats.energy %>/100</label>
                                <div class="progress">
                                    <div class="progress-bar bg-<%= pet.stats.energy > 50 ? 'success' : 'warning' %>" 
                                         style="width: <%= pet.stats.energy %>%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Column - Pet Image -->
                        <div class="col-md-6">
                            <div class="text-center">
                                <div class="pet-image-container mb-3">
                                    <img src="<%= pet.imageUrl %>" 
                                         alt="<%= pet.name %> the <%= pet.species %>" 
                                         class="pet-detail-image">
                                </div>
                                <h4 class="pet-name"><%= pet.name %></h4>
                            </div>
                        </div>
                    </div>

                    <!-- Care buttons -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <h5>Care for Your Pet</h5>
                            <div class="d-grid gap-2 d-md-flex">
                                <form method="POST" action="/pets/<%= pet._id %>/care" class="me-2" id="feedForm">
                                    <input type="hidden" name="action" value="feed">
                                    <button type="submit" class="btn btn-success care-btn" data-action="feed">üçñ Feed</button>
                                </form>
                                <form method="POST" action="/pets/<%= pet._id %>/care" class="me-2" id="playForm">
                                    <input type="hidden" name="action" value="play">
                                    <button type="submit" class="btn btn-info care-btn" data-action="play">üéæ Play</button>
                                </form>
                                <form method="POST" action="/pets/<%= pet._id %>/care" id="restForm">
                                    <input type="hidden" name="action" value="rest">
                                    <button type="submit" class="btn btn-warning care-btn" data-action="rest">üò¥ Rest</button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <% if (pet.needsCare && pet.needsCare()) { %>
                        <div class="alert alert-warning mt-3">
                            <strong>‚ö†Ô∏è Attention!</strong> Your pet needs care! Please feed, play, or let it rest.
                        </div>
                    <% } %>
                </div>
                <div class="card-footer">
                    <form action="/pets/<%= pet._id %>/delete" method="POST" class="d-inline">
                        <button type="submit" class="btn btn-danger" 
                                onclick="return confirm('Are you sure you want to release <%= pet.name %>? This action cannot be undone!')">
                            üö™ Release Pet
                        </button>
                    </form>
                    <a href="/pets" class="btn btn-outline-secondary float-end">Back to List</a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.pet-detail-image {
    width: 280px;
    height: 280px;
    object-fit: cover;
    border-radius: 15px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    transition: transform 0.3s ease;
}

.pet-detail-image:hover {
    transform: scale(1.05);
}

.pet-name {
    font-weight: bold;
    color: #495057;
    margin-top: 10px;
    font-size: 1.5rem;
}

/* Animation Overlay Styles */
.animation-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.5s ease;
}

.animation-overlay.show {
    display: flex;
    opacity: 1;
}

.animation-overlay.fade-out {
    opacity: 0;
}

.animation-gif {
    width: 400px;
    height: 400px;
    object-fit: contain;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .pet-detail-image {
        width: 220px;
        height: 220px;
        margin-bottom: 1rem;
    }
    
    .pet-name {
        font-size: 1.3rem;
    }
    
    .animation-gif {
        width: 300px;
        height: 300px;
    }
}

@media (max-width: 576px) {
    .pet-detail-image {
        width: 180px;
        height: 180px;
    }
    
    .pet-name {
        font-size: 1.2rem;
    }
    
    .animation-gif {
        width: 250px;
        height: 250px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const careButtons = document.querySelectorAll('.care-btn');
    const animationOverlay = document.getElementById('animationOverlay');
    const animationGif = document.getElementById('animationGif');
    
    // Audio files
    const audioFiles = {
        feed: '/audio/eatingsound.mp3',
        play: '/audio/playingsound.mp3',
        rest: '/audio/sleepingsound.mp3'
    };
    
    // GIF files
    const gifFiles = {
        feed: '/images/eating.gif',
        play: '/images/playing.gif',
        rest: '/images/sleeping.gif'
    };
    
    careButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const action = this.getAttribute('data-action');
            
            // Play sound
            const audio = new Audio(audioFiles[action]);
            audio.play().catch(error => {
                console.log('Audio play failed:', error);
            });
            
            // Show animation
            animationGif.src = gifFiles[action];
            animationOverlay.classList.add('show');
            
            // Hide animation after 4 seconds with fade out
            setTimeout(() => {
                animationOverlay.classList.add('fade-out');
                setTimeout(() => {
                    animationOverlay.classList.remove('show', 'fade-out');
                    // Submit the form after animation completes
                    const form = this.closest('form');
                    form.submit();
                }, 500); // Fade out duration
            }, 3000); // Display duration
            
            // Disable button to prevent multiple clicks
            this.disabled = true;
        });
    });
});
</script>

<%- include('../partials/footer', { dbStatus: dbStatus }) %>
